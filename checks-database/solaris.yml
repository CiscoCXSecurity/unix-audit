platformtags:
  - "Solaris"
checks:
  - type: "Informational"
    checks:
      - name: "Hostname"
        exec:
          - command: "cat /etc/nodename"
            stderr: false
            encode: ""
      - name: "Kernel version"
        exec:
          - command: "uname -a"
            stderr: false
            encode: ""
      - name: "Network interfaces"
        exec:
          - command: "ifconfig -a"
            stderr: false
            encode: ""
  - type: "Environment"
    checks:
      - name: "PCI cards accessible"
        exec:
          - command: "prtconf -v"
            stderr: false
            encode: ""
      - name: "USB peripherals accessible"
        exec:
          - command: "prtconf -v"
            stderr: false
            encode: ""
      - name: "Loaded kernel modules"
        exec:
          - command: "modinfo"
            stderr: false
            encode: ""
      - name: "OBP password set"
        exec:
          - command: "eeprom | grep \"security-mode\""
            stderr: false
            encode: ""
      - name: "OBP banner set"
        exec:
          - command: "eeprom | grep \"oem-banner\""
            stderr: false
            encode: ""
      - name: "Grub password set"
        exec:
          - command: "/sbin/bootadm list-menu; grep password \"/path/to/menu.lst\""
            stderr: false
            encode: ""
      - name: "Stop-A"
        exec:
          - command: "grep \"abort_enable\" /etc/system"
            stderr: false
            encode: ""
      - name: "Zones"
        exec:
          - command: "zoneadm list"
            stderr: false
            encode: ""
  - type: "Networking"
    checks:
      - name: "ARP"
        exec:
          - command: "arp -a; cat /etc/ethers"
            stderr: false
            encode: ""
      - name: "Routing"
        exec:
          - command: "netstat -rn; cat /etc/defaultrouter"
            stderr: false
            encode: ""
      - name: "Name services"
        exec:
          - command: "cat /etc/nsswitch.conf"
            stderr: false
            encode: ""
      - name: "Hosts"
        exec:
          - command: "cat /etc/hosts"
            stderr: false
            encode: ""
      - name: "DNS"
        exec:
          - command: "cat /etc/resolv.conf"
            stderr: false
            encode: ""
      - name: "Internet"
        exec:
          - command: "ping -c 5 www.google.co.uk; ping -c 5 8.8.8.8"
            stderr: false
            encode: ""
      - name: "Listening services"
        exec:
          - command: "netstat -an | egrep \"LISTEN|TCP|UDP\"; netstat -aun | egrep \"LISTEN|TCP|UDP\""
            stderr: false
            encode: ""
      - name: "IPv6"
        exec:
          - command: "ifconfig lo | grep \"::1\"; ls /etc/hostname6.*"
            stderr: false
            encode: ""
  - type: "Network stack tuning"
    checks:
      - name: "IP forwarding"
        exec:
          - command: "cat /etc/notrouter; ndd /dev/ip ip_forwarding; ndd /dev/ip ip6_forwarding"
            stderr: false
            encode: ""
      - name: "Source routing"
        exec:
          - command: "ndd /dev/ip ip_forward_src_routed; ndd /dev/ip ip6_forward_src_routed"
            stderr: false
            encode: ""
      - name: "Directed broadcasts"
        exec:
          - command: "ndd /dev/ip ip_forward_directed_broadcasts; ndd /dev/ip ip6_forward_directed_broadcasts"
            stderr: false
            encode: ""
      - name: "Echo broadcasts"
        exec:
          - command: "ndd /dev/ip ip_respond_to_echo_broadcasts; ndd /dev/ip ip_respond_to_echo_multicast; ndd /dev/ip ip6_respond_to_echo_multicast"
            stderr: false
            encode: ""
      - name: "Timestamp broadcasts"
        exec:
          - command: "ndd /dev/ip ip_respond_to_timestamp; ndd /dev/ip ip_respond_to_timestamp_broadcast"
            stderr: false
            encode: ""
      - name: "Redirects"
        exec:
          - command: "ndd /dev/ip ip_ignore_redirect; ndd /dev/ip ip6_ignore_redirect"
            stderr: false
            encode: ""
      - name: "Netmask broadcasts"
        exec:
          - command: "ndd /dev/ip ip_respond_to_address_mask_broadcast"
            stderr: false
            encode: ""
      - name: "TCP limits"
        exec:
          - command: "ndd /dev/tcp tcp_conn_req_max_q; ndd /dev/tcp tcp_conn_req_max_q0"
            stderr: false
            encode: ""
      - name: "Strict multihoming"
        exec:
          - command: "ndd /dev/ip ip_strict_dst_multihoming; ndd /dev/ip ip6_strict_dst_multihoming"
            stderr: false
            encode: ""
      - name: "Strong ISS"
        exec:
          - command: "grep \"TCP_STRONG_ISS\" /etc/default/inetinit; ndd /dev/tcp tcp_strong_iss"
            stderr: false
            encode: ""
      - name: "Generic tuning - we should break this down and cross reference OS"
        exec:
          - command: "for device in arp ip ip6 rawip rawip6 sockets tcp udp; do echo \"Device: $device\"; ndd /dev/$device '?' | grep -v '?' | while read parameter _; do echo \"Parameter: $parameter\"; ndd /dev/$device $parameter; done; done"
            stderr: false
            encode: ""
  - type: "Access control"
    checks:
      - name: "Firewall configured"
        exec:
          - command: "cat /etc/ipf/ipf.conf"
            stderr: false
            encode: ""
      - name: "TCP wrappers used"
        exec:
          - command: "cat /etc/hosts.allow; cat /etc/hosts.deny"
            stderr: false
            encode: ""
      - name: ".rhosts used"
        exec:
          - command: "find / -name .rhosts -ls"
            stderr: false
            encode: ""
      - name: "hosts.equiv used"
        exec:
          - command: "cat /etc/hosts.equiv"
            stderr: false
            encode: ""
      - name: ".netrc used"
        exec:
          - command: "find / -name .netrc -ls"
            stderr: false
            encode: ""
      - name: "Remote X"
        exec:
          - command: "netstat -an | grep \"LISTEN\" | egrep \"6000|177\""
            stderr: false
            encode: ""
      - name: "Accounts with non-standard shells"
        exec:
          - command: "grep -v \"/bash$\" /etc/passwd"
            stderr: false
            encode: ""
      - name: "Valid shells"
        exec:
          - command: "cat /etc/shells"
            stderr: false
            encode: ""
      - name: "SSH ACLs configured"
        exec:
          - command: "grep \"Match\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH user logins"
        exec:
          - command: "egrep \"AllowUsers|DenyUsers|AllowGroups|DenyGroups\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH root logins"
        exec:
          - command: "grep \"PermitRootLogin\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH TCP forwarding"
        exec:
          - command: "grep \"AllowTcpForwarding\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH gateway ports"
        exec:
          - command: "grep \"GatewayPorts\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH VPN"
        exec:
          - command: "grep \"PermitTunnel\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH agent forwarding"
        exec:
          - command: "grep \"AllowAgentForwarding\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH X11 forwarding"
        exec:
          - command: "grep \"X11Forwarding\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH binds X11 to localhost"
        exec:
          - command: "grep \"X11UseLocalhost\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH reads environment from user file"
        exec:
          - command: "grep \"PermitUserEnvironment\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH accepts environment variables"
        exec:
          - command: "grep \"AcceptEnv\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH looks up connections in DNS"
        exec:
          - command: "grep \"UseDNS\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH uses privilege separation"
        exec:
          - command: "grep \"UsePrivilegeSeparation\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: ".shosts used"
        exec:
          - command: "find / -name .shosts -ls"
            stderr: false
            encode: ""
      - name: "shosts.equiv used"
        exec:
          - command: "cat /etc/shosts.equiv"
            stderr: false
            encode: ""
      - name: "SSH allows .rhosts"
        exec:
          - command: "grep \"IgnoreRhosts\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH public/private keys used"
        exec:
          - command: "find / -name .ssh -type d -exec ls -la {} \\;"
            stderr: false
            encode: ""
      - name: "SSH sessions are throttled"
        exec:
          - command: "grep \"MaxStartups\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "FTP users disallowed"
        exec:
          - command: "cat /etc/ftpd/ftpuser"
            stderr: false
            encode: ""
      - name: "NFS shares"
        exec:
          - command: "cat /etc/dfs/sharetab; share -A"
            stderr: false
            encode: ""
      - name: "Secure consoles"
        exec:
          - command: "grep \"CONSOLE\" /etc/default/login"
            stderr: false
            encode: ""
  - type: "Authentication"
    checks:
      - name: "Banner"
        exec:
          - command: "cat /etc/issue"
            stderr: false
            encode: ""
      - name: "MOTD"
        exec:
          - command: "cat /etc/motd"
            stderr: false
            encode: ""
      - name: "Passwords"
        exec:
          - command: "cat /etc/passwd; cat /etc/shadow; passwd -a -s | grep \"NP\""
            stderr: false
            encode: ""
      - name: "SNMP community strings"
        exec:
          - command: "grep \"community\" /etc/snmp/conf/snmpd.conf; grep \"community\" /etc/net-snmp/conf/snmpd.conf"
            stderr: false
            encode: ""
      - name: "Login policy"
        exec:
          - command: "cat /etc/default/login"
            stderr: false
            encode: ""
      - name: "Password aging"
        exec:
          - command: "grep \"WEEKS\" /etc/default/passwd"
            stderr: false
            encode: ""
      - name: "Password minimum strength"
        exec:
          - command: "cat /etc/default/passwd"
            stderr: false
            encode: ""
      - name: "Unlocked accounts"
        exec:
          - command: "passwd -a -s | egrep -v \"LK|NL\""
            stderr: false
            encode: ""
      - name: "Lock after retries"
        exec:
          - command: "grep \"LOCK_AFTER_RETRIES\" /etc/security/policy.conf; grep \"RETRIES\" /etc/default/login"
            stderr: false
            encode: ""
      - name: "Session timeout"
        exec:
          - command: "grep \"TMOUT\" /etc/profile"
            stderr: false
            encode: ""
      - name: "SSH shows banner"
        exec:
          - command: "grep \"Banner\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH shows MOTD"
        exec:
          - command: "grep \"PrintMotd\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH allows empty passwords"
        exec:
          - command: "grep \"PermitEmptyPasswords\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
  - type: "Cryptography"
    checks:
      - name: "known_hosts encrypted"
        exec:
          - command: "grep \"HashKnownHosts\" /etc/ssh/ssh_config"
            stderr: false
            encode: ""
      - name: "SSH protocol"
        exec:
          - command: "grep \"Protocol\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH protocol 1 key regeneration"
        exec:
          - command: "grep \"KeyRegenerationInterval\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH protocol 1 key size"
        exec:
          - command: "grep \"ServerKeyBits\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH protocol 2 public key authentication"
        exec:
          - command: "grep \"PubkeyAuthentication\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH allows .rhosts with protocol 1 RSA"
        exec:
          - command: "grep \"RhostsRSAAuthentication\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH allows protocol 1 RSA"
        exec:
          - command: "grep \"RSAAuthentication\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH password based authentication"
        exec:
          - command: "grep \"PasswordAuthentication\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH ciphers"
        exec:
          - command: "grep \"Ciphers\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "SSH MACs"
        exec:
          - command: "grep \"MACs\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "Blacklisted keys"
        exec:
          - command: "grep \"PermitBlacklistedKeys\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "Grub password obfuscated"
        exec:
          - command: "grep \"password\" /path/to/menu.lst | grep \"md5\""
            stderr: false
            encode: ""
      - name: "Crypto used for shadow"
        exec:
          - command: "grep \"CRYPT_DEFAULT\" /etc/security/policy.conf"
            stderr: false
            encode: ""
      - name: "Crypto allowed for shadow"
        exec:
          - command: "grep \"CRYPT_ALGORITHMS_ALLOW\" /etc/security/policy.conf "
            stderr: false
            encode: ""
  - type: "Software installed"
    checks:
      - name: "OS release"
        exec:
          - command: "uname -r"
            stderr: false
            encode: ""
      - name: "Packages installed"
        exec:
          - command: "pkginfo; pkg list"
            stderr: false
            encode: ""
      - name: "Packages legit"
        exec:
          - command: "pkg verify"
            stderr: false
            encode: ""
      - name: "Patches installed"
        exec:
          - command: "showrev -p; smpatch analyze"
            stderr: false
            encode: ""
      - name: "Processes"
        exec:
          - command: "ps -aef"
            stderr: false
            encode: ""
      - name: "Services"
        exec:
          - command: "svcs"
            stderr: false
            encode: ""
      - name: "Development tools"
        exec:
          - command: "find / -type f \\( -name perl -o -name gcc -o -name javac -o -name python -o -name ruby -o -name cc -o -name gdb -o -name mdb \\)"
            stderr: false
            encode: ""
      - name: "3rd party software"
        exec:
          - command: "find /usr/local /opt -type f -ls"
            stderr: false
            encode: ""
  - type: "Logging"
    checks:
      - name: "Time synchronisation"
        exec:
          - command: "grep \"server\" /etc/inet/ntp.conf"
            stderr: false
            encode: ""
      - name: "Remote logging"
        exec:
          - command: "grep \"@\" /etc/syslog.conf"
            stderr: false
            encode: ""
      - name: "Cron logging"
        exec:
          - command: "grep \"CRONLOG\" /etc/default/cron"
            stderr: false
            encode: ""
      - name: "Auditing"
        exec:
          - command: "ps -aef | grep \"auditd\""
            stderr: false
            encode: ""
  - type: "Resource limits"
    checks:
      - name: "Running limits"
        exec:
          - command: "ulimit -a"
            stderr: false
            encode: ""
      - name: "Tmp size"
        exec:
          - command: "grep \"swap\" /etc/vfstab | grep \"size\""
            stderr: false
            encode: ""
      - name: "Disk quotas"
        exec:
          - command: "mount | grep \"quota\""
            stderr: false
            encode: ""
  - type: "File permissions"
    checks:
      - name: "Init umask"
        exec:
          - command: "grep \"CMASK\" /etc/default/init"
            stderr: false
            encode: ""
      - name: "Root umask"
        exec:
          - command: "grep \"umask\" /root/.profile"
            stderr: false
            encode: ""
      - name: "User umask"
        exec:
          - command: "grep \"umask\" /etc/profile"
            stderr: false
            encode: ""
      - name: "Service umasks"
        exec:
          - command: "grep \"umask\" /etc/init.d/* /etc/rc*.d/*"
            stderr: false
            encode: ""
      - name: "World readable files / directories"
        exec:
          - command: "find / -perm -o+r -ls"
            stderr: false
            encode: ""
      - name: "World writable files / directories"
        exec:
          - command: "find / -perm -o+w -ls"
            stderr: false
            encode: ""
      - name: "Group writable files / directories"
        exec:
          - command: "find / -perm -o+w -ls"
            stderr: false
            encode: ""
      - name: "Unowned files / directories"
        exec:
          - command: "find / -nouser -ls"
            stderr: false
            encode: ""
      - name: "Ungrouped files / directories"
        exec:
          - command: "find / -nogroup -ls"
            stderr: false
            encode: ""
      - name: "Log files"
        exec:
          - command: "ls -la /var/log /var/adm"
            stderr: false
            encode: ""
      - name: "SSH strict mode"
        exec:
          - command: "grep \"StrictModes\" /etc/ssh/sshd_config"
            stderr: false
            encode: ""
      - name: "Root home"
        exec:
          - command: "ls -ld `cat /etc/passwd | grep \"root\" | cut -f 6 -d \":\"`; ls -la /path/to/root"
            stderr: false
            encode: ""
      - name: "IPC"
        exec:
          - command: "ipcs -A"
            stderr: false
            encode: ""
      - name: "Device policy"
        exec:
          - command: "cat /etc/security/device_policy"
            stderr: false
            encode: ""
  - type: "Exploit mitigation"
    checks:
      - name: "Active mounts secure"
        exec:
          - command: "mount | grep -v \"noexec\"; mount | grep -v \"nosetuid\"; mount | grep -v \"nosuid\"; mount | grep -v \"norstchown\""
            stderr: false
            encode: ""
      - name: "Configured mounts secure"
        exec:
          - command: "grep -v \"noexec\" /etc/vfstab; grep -v \"nosetuid\" /etc/vfstab; grep -v \"nosuid\" /etc/vfstab; grep -v \"norstchown\" /etc/vfstab"
            stderr: false
            encode: ""
      - name: "Separate partitions"
        exec:
          - command: "mount"
            stderr: false
            encode: ""
      - name: "Cron users"
        exec:
          - command: "cat /etc/cron.allow"
            stderr: false
            encode: ""
      - name: "At users"
        exec:
          - command: "cat /etc/at.allow"
            stderr: false
            encode: ""
      - name: "Non executable stack"
        exec:
          - command: "grep \"noexec_user_stack\" /etc/system"
            stderr: false
            encode: ""
      - name: "Stack randomisation"
        exec:
          - command: "sxadm info"
            stderr: false
            encode: ""
      - name: "Randomised binaries"
        exec:
          - command: "find / -type f \\( -perm -u+s -o -perm -g+s \\) | while read file; do echo \"File: $file\"; elfdump $file | grep \"ASLR\"; done"
            stderr: false
            encode: ""
      - name: "Basic profile"
        exec:
          - command: "grep \"_GRANTED\" /etc/security/policy.conf"
            stderr: false
            encode: ""
      - name: "Console profile"
        exec:
          - command: "grep \"CONSOLE_USER\" /etc/security/policy.conf"
            stderr: false
            encode: ""
      - name: "Basic privs"
        exec:
          - command: "grep \"PRIV_DEFAULT\" /etc/security/policy.conf"
            stderr: false
            encode: ""
      - name: "Priv limits"
        exec:
          - command: "grep \"PRIV_LIMIT\" /etc/security/policy.conf"
            stderr: false
            encode: ""
  - type: "Privilege escalation"
    checks:
      - name: "Init scripts run"
        exec:
          - command: "cat /etc/inittab; cat /etc/inittab | cut -f 4 -d: | cut -f 1 -d \" \" | while read file; do echo \"File: $file\"; ls -la $file; done"
            stderr: false
            encode: ""
      - name: "At scripts run"
        exec:
          - command: "for file in /var/spool/cron/atjobs/*; do echo \"File: $file\"; ls -l $file; cat $file; done"
            stderr: false
            encode: ""
      - name: "Cron scripts run"
        exec:
          - command: "for file in /var/spool/cron/crontabs/*; do echo \"File: $file\"; ls -l $file; cat $file; done"
            stderr: false
            encode: ""
      - name: "Default path"
        exec:
          - command: "grep \"PATH\" /etc/profile; echo $PATH"
            stderr: false
            encode: ""
      - name: "User paths"
        exec:
          - command: "grep \"PATH\" /etc/skel/.profile; echo $PATH"
            stderr: false
            encode: ""
      - name: "Init paths"
        exec:
          - command: "grep \"PATH\" /etc/init.d/* /etc/rc*.d"
            stderr: false
            encode: ""
      - name: "Default linker path"
        exec:
          - command: "grep \"LD_LIBRARY_PATH\" /etc/profile; echo $LD_LIBRARY_PATH"
            stderr: false
            encode: ""
      - name: "User linker paths"
        exec:
          - command: "grep \"LD_LIBRARY_PATH\" /etc/skel/.profile"
            stderr: false
            encode: ""
      - name: "Init linker paths"
        exec:
          - command: "grep \"LD_LIBRARY_PATH\" /etc/init.d/* /etc/rc*.d"
            stderr: false
            encode: ""
      - name: "SetUID files"
        exec:
          - command: "find / -perm -u+s -type f -ls"
            stderr: false
            encode: ""
      - name: "SetGID files"
        exec:
          - command: "find / -perm -g+s -type f -ls"
            stderr: false
            encode: ""
      - name: "Sudo configuration"
        exec:
          - command: "cat /etc/sudoers; for file in /etc/sudoers.d/*; do echo \"File: $file\"; cat $file; done"
            stderr: false
            encode: ""
      - name: "Roles"
        exec:
          - command: "cat /etc/user_attr; cat /etc/passwd | cut -f 1 -d \":\" | while read user; do echo \"User: $user\"; roles $user; done"
            stderr: false
            encode: ""
      - name: "Profiles"
        exec:
          - command: "cat /etc/security/prof_attr; for file in /etc/security/prof_attr.d/*; do echo \"File: $file\"; cat $file; done"
            stderr: false
            encode: ""
      - name: "Command profiles"
        exec:
          - command: "cat /etc/security/exec_attr; for file in /etc/security/exec_attr.d/*; do echo \"File: $file\"; cat $file; done"
            stderr: false
            encode: ""
  - type: "Common services"
    checks:
      - name: "SSH running config"
        exec:
          - command: "sshd -T"
            stderr: false
            encode: ""
      - name: "Web server config"
        exec:
          - command: "find / -name httpd.conf | while read file; do echo \"File: $file\"; ls -l $file; cat $file; done"
            stderr: false
            encode: ""
      - name: "Web server cgi-bin"
        exec:
          - command: "find /usr/lib -name cgi-bin | while read file; do echo \"File: $file\"; ls -l $file; done"
            stderr: false
            encode: ""
